# 0928_WS

### 1. Model

```python
# article과 user 간의 관계 N:M
# articles/models.py

from django.db import models
from django.conf import settings

class Article(models.Model):
    user=models.ForeignKey(settings.AUTH_USER_MODEL,on_delete=models.CASCADE)   		     like_users=models.ManyToManyField(settings.AUTH_USER_MODEL, related_name='like_articles'), # 추가!!!!!!
    title=models.CharField(max_length=10)
    content=models.TextField()
    created_at=models.DataTimeField(auto_now_add=True)
    updated_at=models.DataTimeField(auto_now=True)
    ....

```



### 2. url & view

/articles/<article_pk>/like/ 
좋아요 작성을 위한 기능을 구현한다.  로그인한 유저의 요청만 처리한다.

```python
# articles/urls.py

from django.urls import path
from . import views

app_name='articles'

urlpatterns=[
    ...
    path('<int:article_pk>/like/',views.like, name='like'),
]
```

```python
# articles/views.py

def like(request,article_pk):
    if request.user.is_authenticated:
        article=get_object_or_404(Article,pk=article_pk)
        if article.like_users.filter(pk=request.user.pk).exists():
            article.like_users.remove(request.user)
        else:
            article.like_users.add(request.user)
        return redirect('articles:index')
    return redirect('accounts:login')
```



### 3. template

font-awesome에서 좋아요 로직 구현에 활용할 로고를 선택한다.

- 개인 키트를 발급 받은 후 base.html에 붙여 넣는다. 
- 좋아요에 활용되는 로고를 선택한다. 
- index.html에 좋아요 여부에 따른 결과를 보여준다. 
- 좋아요를 누른 경우 빨간색 하트, 그렇지 않은 경우 검은색 하트가 나타나도록 한다. §     특정 글의 좋아요를 누른 전체 인원수를 출력한다.

```html
# articles/index.html

...

    <form action="{% url 'articles:like' article.pk %}" method='POST' class='d-inline'>
      {% csrf_token%}
      {% if request.user in article.like_users.all %}
      <button type="submit" class="btn btn-link" style="color:crimson;">
        <i class="fas fa-heart"></i>
      </button>
      {% else %}
      <button type="submit" class="btn btn-link" style="color: black;">
        <i class="fas fa-heart"></i>
      </button>
      {% endif %}
    </form>
    {{ article.like_users.all|length }} 명이 이 글을 좋아합니다. <br>
    <a href="{% url 'articles:detail' article.pk %}">[detail]</a>
    <hr>
  {% endfor %}
```



### 결과 사진

![p1](C:\Users\User\Dropbox\내 PC (DESKTOP-Q5BBD02)\Desktop\p1.PNG)